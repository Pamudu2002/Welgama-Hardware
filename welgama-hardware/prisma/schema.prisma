generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // ADD THIS LINE BACK:
  url      = env("DATABASE_URL")
}

// --- USER ROLES ---
model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  role      String   // "Owner" or "Cashier"
  createdAt DateTime @default(now())
  sales     Sale[]   
  
}

// --- INVENTORY ---
model Category {
  id        Int       @id @default(autoincrement())
  name      String    @unique
  products  Product[]
}

model Product {
  id                Int         @id @default(autoincrement())
  name              String
  categoryId        Int
  category          Category    @relation(fields: [categoryId], references: [id])
  costPrice         Decimal     @db.Decimal(10, 2) 
  sellingPrice      Decimal     @db.Decimal(10, 2)
  quantity          Int         @default(0)
  unit              String      
  lowStockThreshold Int         @default(5)
  
  saleItems         SaleItem[]
}

// --- CUSTOMERS & CREDIT ---
model Customer {
  id        Int       @id @default(autoincrement())
  name      String
  phone     String?
  address   String?
  balance   Decimal   @default(0.0) @db.Decimal(10, 2) 
  
  sales     Sale[]
  payments  Payment[]
}

// --- SALES & TRANSACTIONS ---
model Sale {
  id            Int        @id @default(autoincrement())
  userId        Int
  user          User       @relation(fields: [userId], references: [id])
  
  customerId    Int?       
  customer      Customer?  @relation(fields: [customerId], references: [id])
  
  date          DateTime   @default(now())
  totalAmount   Decimal    @db.Decimal(10, 2)
  paymentStatus String     
  
  items         SaleItem[]
  payments      Payment[]
}

model SaleItem {
  id            Int      @id @default(autoincrement())
  saleId        Int
  sale          Sale     @relation(fields: [saleId], references: [id])
  
  productId     Int
  product       Product  @relation(fields: [productId], references: [id])
  
  quantity      Int
  priceSnapshot Decimal  @db.Decimal(10, 2) 
  subtotal      Decimal  @db.Decimal(10, 2)
}

model Payment {
  id          Int      @id @default(autoincrement())
  saleId      Int?     
  sale        Sale?    @relation(fields: [saleId], references: [id])
  
  customerId  Int
  customer    Customer @relation(fields: [customerId], references: [id])
  
  date        DateTime @default(now())
  amount      Decimal  @db.Decimal(10, 2)
  note        String?  
}